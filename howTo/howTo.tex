\documentclass{article}
\usepackage{listings}
\usepackage{tcolorbox}
\usepackage{hyperref} 
\usepackage{listings}
\usepackage{xcolor}
\usepackage{hyperref}
\definecolor{WhiteSmoke}{HTML}{F5F5F5}
\definecolor{BlueViolet}{HTML}{8A2BE2}
\lstset{language=Perl,
	keywordstyle=\color{BlueViolet}\bfseries, 
	basicstyle=\ttfamily, 
	showstringspaces=false, 
	numbers=left,
	backgroundcolor=\color{WhiteSmoke},
	breaklines=true
}
\title{\textbf{How To Write A Minimal \LaTeX ML Binding}}
\author{Authors: Hang Yuan, Jinbo Zhang \\ \\Co-author: Prof. Dr. Michael Kohlhase}
\date{\today}
\begin{document}
\maketitle
\begin{center}
Jacobs University Bremen
\end{center}
\noindent\LaTeX\ has been widely used as a word processing tool among scholars, especially when one needs to use large quantities of mathematical representations. \LaTeX\ is also a good choice for those who are meticulous about typographical quality of documents. However, \LaTeX\ lacks a conversion tool to XML which DLMF(Digital Library of Mathematical Functions) uses for delivery. DLMF developed \LaTeX ML , trying to make a new typesetting system that allows users to be able to focus more on the content, but not the style, by providing extensive ways of customizations. In order to achieve this goal, building up the document class binding seems crucial, and yet \LaTeX ML seems fairly unfathomable for beginners. We want to make it easier for those who
want to pick up using \LaTeX ML in the future, by going through how to construct a minimal \LaTeX ML binding step by step. \\

\noindent This document does not cover advanced topics related \LaTeX ML, and thus if you are interested in the general theories, you can have the manual hand in hand with this document to better comprehend how the theories are implemented. In addition, we will refer you to the particular chapters in the manual, when needed.

\section{Using LaTeXML}
We are going to talk about various aspects of \LaTeX ML, and then we will move onto the workflow of creating your first \LaTeX\ document class binding. In this tutorial, we use the command:

\begin{lstlisting}
latexmlc <Filename>  --format=XML --destination=<Filename> --log=<Filename>.log
\end{lstlisting}
for converting \TeX\ document into *.xml 
One quick note in regards to \LaTeX ML installation, when you think you have finished installing \LaTeX ML, run a simple conversion command. You should be able to see an XML interpretation of \textit{mockDoc.tex} in a newly-generated XML file. It is totally fine to see tons of mysterious 
error messages at this point, because we have not created anything yet. Under some circumstances when your \LaTeX ML doesn't seem
to function, maybe you have overlooked the prerequisites such as \texttt{libxml2} or \texttt{libxslt} \footnote{Please visit \url{http://dlmf.nist.gov/LaTeXML/get.html} for more information.}. \\

\begin{tcolorbox}
\emph{For more information about how to use \LaTeX ML, please have a look at the \href{http://dlmf.nist.gov/LaTeXML/manual.pdf}{\LaTeX ML Manual} Chapter 2: Using \LaTeX ML.}
\end{tcolorbox}

\section{How to Create a LaTeXML Binding}
The conversion from \TeX\  to XML is processed by \LaTeX ML. Basically \LaTeX ML maps the \TeX \ markups to the XML markups, more specifically macros, primitives and constructors. That's why you are able to customize the conversion between \TeX\  and XML, in three ways: modifying the bindings used by \texttt{latexml}, adding your own bindings that has not been implemented, and even creating your own \TeX \ style and \LaTeX\  binding which is the goal of this tutorial.
\subsection{Things We Need}
It probably would be a good idea to name every file after the same prefix which will make your life easier in the future. We need to have:
\begin{itemize}
\item[\texttt{*.tex}] As your source file, so you can have something to convert from. You can write down whatever you want and base on this \texttt{*.tex} file, your other files will vary. Feel free to define your own macros into something unusual such that, even if you accidentally load the \TeX\ binding in \LaTeX ML, the conversion will fail, ensuring all conversions are done by \LaTeX ML binding. \\

\item[\texttt{*.cls}] For pdf\LaTeX, which essentially helps you to see what \texttt{*.tex} file looks like in a pdf format. \\ 

\item[\texttt{*.cls.ltxml}] \LaTeX ML binding, similar to the *.doc.cls you have for \LaTeX, but used for the conversion to other formats. \\

\item[\texttt{*.rnc}] The RelaxNG schema compact form, which defines the structure of your .tex, crucial for executing tasks like placing the tags correctly and auto closing the tags when needed. \\

\item[\texttt{trang.jar}](optional): \LaTeX ML cannot process the compact form scheme, and therefore you need \texttt{trang.jar} to convert your \texttt{*.rnc} into \texttt{*.rng}, unless you want to write your scheme in \texttt{*.rng} in the first place, albeit this approach is not recommended for lack of efficiency and difficulty of maintenance.
\end{itemize}

\noindent After you have finished writing all the documents above, run \texttt{latexml}, and then you should be able to see the converted XML file for your \texttt{*.tex}. In the following chapters I will explain how to construct your \texttt{*.doc.ltxml} and \texttt{*.rnc}.

\subsection{Minimal \LaTeX ML}
Since \LaTeX\ binding is a perl module, we need to initialize a binding file by add the followings in the beginning of \texttt{*.doc.ltxml}: \\
\begin{lstlisting}
package LaTeXML::Package::Pool;
use strict;
use LaTeXML::Package;
use warnings;
\end{lstlisting}
At the end of \texttt{*.doc.ltxml} don't forget to include \\
\begin{lstlisting}
1;
\end{lstlisting}
to make sure perl work properly.

\begin{tcolorbox}
{\emph{It will be good to read the \href{http://dlmf.nist.gov/LaTeXML/manual.pdf}{\LaTeX ML Manual} Chapter 4: Customization, before
your proceed and come back to see how the theories are implemented.}}
\end{tcolorbox}

\noindent Assuming you have read chapter 4 thoroughly, and get some feelings about how things work. Now you want to teach \LaTeX ML the new commands you created in your \texttt{*.tex} file. Let's look at an example below:\\

\begin{lstlisting}
DefConstructor('\newline',"<mock:break/>");
\end{lstlisting}

\noindent The reason why I use the break as an example is because you might encounter problems dealing with break in \LaTeX ML. The two backlashes macro is preserved in pool package, that's why if you still use the regular newline break macro, your \LaTeX ML will have a malformed error. Renaming your newline macro in your \texttt{*.tex} will solve the problem for you.\\

\noindent After you link your \texttt{*.tex} file and \texttt{*.cls.ltxml} file by changing your document class in your \texttt{*.tex} into your \LaTeX ML binding name, in our case,``doc". \LaTeX ML will load your binding file, when it tries to do the conversion.\\

\noindent You might be wondering how \LaTeX ML reads your binding. To put it in a simple way, during the conversion process, whenever \LaTeX ML encounters a macro or control sequence, it will look for its replacement in your binding and then put the replacement in \texttt{*.xml}. This is where things get a little tricky. How about the closing tag? Just like \textbf{section} macro, you declare where the \textbf{section} starts and were the next \textbf{section} starts, nevertheless, you never write now close section, so \LaTeX ML will never close the section tags? Yes and no. Indeed \LaTeX ML will have no clue of where to close the declared tags if we don't tell it when to do so. Using a schema can solve this problem.

\subsection{RelaxNG Schema}
Schema is a crucial document that decides how \texttt{*.xml} is constructed. When you are creating your own schema, it is a good idea to have your \texttt{*.tex} document open side by side to make sure your scheme works well with your \texttt{*.tex} file. \\ \\
One good approach to test this is to create your expected \texttt{*.xml} by hand, according to your \texttt{*.tex}. You can easily accomplish this by using \textit{emacs nxml mode} in which you have the freedom to write your expected \texttt{*.xml}, while validating your \texttt{*.xml} at the same time. If validation fails, you can see the error message instantly, such that you can debug your \texttt{*.xml} or schema accordingly.
\begin{tcolorbox}
Tutorial: \href{http://www.emacswiki.org/emacs/NxmlMode}{Emacs: Nxml Mode} 
\end{tcolorbox} 

\noindent In our \texttt{mockDoc.rnc}, you can easily see under a document, there can be either \textbf{p} or \textbf{section}, and under a \textbf{section} there can be a title followed by \textbf{p} or a title followed by a \textbf{subsection}. This is because in the first section in \texttt{mockDoc.tex}, there is no \textbf{subsection} but text directly. But in the other \textbf{section}s, there are \textbf{subsection}s. In your schema you need to consider all kinds of possible hierarchy of your elements.

\begin{tcolorbox}
Before you write your expected xml and RelaxNG schema, having a look at the links below can be beneficial: \\ \\
I.\href{http://relaxng.org/compact-tutorial-20030326.html}{RelaxNG Syntax Tutorial}; \\ \\
II. \href{http://www.w3schools.com/xml/}{XML tutorial}. 
\end{tcolorbox} 

\paragraph{Some more improvements:} If you have followed what we said, very likely you still have many errors when you use \LaTeX ML to compile your files. Don't be frustrated by this, when we tried to make our first binding, it didn't exit at all. The success is within a reach. We only need to deal with two more things, namespace and putting spaces in your text. 

\noindent We have a default namespace in the schema and we need to declare the schema in the binding and associate the prefix with the namespace. That's an easy step. Then we come to the obscure command of putting spaces between two words. It is related to the architecture of \LaTeX ML, which is far beyond the scope of this tutorial. So you can just do what is in the doc.cls.ltxml.\\
\lstinputlisting[firstline=11,lastline=11]{doc.cls.ltxml} 
Now you should have a minimal setup of what is required for a \LaTeX ML binding. \\ 

\noindent\textbf{Congratulations} for being able to follow this tutorial to the end. After processing the makefile, you should be able to see the generated \texttt{*.xml} in your current directory which hopefully should look something similar to your expected \texttt{*.xml}! \\

\end{document}